# dengFOC学习

参考资料：

* DENG FOC文档：`http://dengfoc.com/#/`

* 淘宝店：`https://shop564514875.taobao.com/`
* DengFOC 软件：`https://github.com/ToanTech/DengFOC_Lib`
* DengFOC 硬件：`https://github.com/ToanTech/DengFOC_Lib`
* 视频学习：`https://www.bilibili.com/video/BV1dy4y1X7yx`

## 1. 无刷电机概念与控制原理

### 1.1 无刷电机的基本结构

![1-1](dengFOC学习.assets/1-1.png)

基本的航模无刷电机结构图如上图所示，分为前盖，中盖，后盖，磁铁，硅钢片，漆包线、轴承和转轴组成。

更加宏观上分，可以直接把电机分为。

- **定子**：就是有线圈绕组，固定不动的部分；
- **转子**：就是电机旋转的部分，用于输出电机的转动和扭矩。

进一步的，无刷电机可以分为：

- **内转子无刷电机：**就是转子在内部。
- **外转子无刷电机：**就是转子在外面，我们常见的无刷电机。比如航模无刷电机，就是外转子无刷电机。

**直流无刷电机的驱动**，就是依靠改变电机定子线圈的电流交变频率和波形, 在定子周围形成磁场, 驱动转子永磁体转动, 进而带动电机转起来。所以，想要让电机成功驱动，研究如何改变定子线圈的电流交变频率和波形就是我们的工作重点。

这个重点就可以进一步的分为两部分进行研究：

* 硬件电路部分

* 软件控制部分

### 1.2 无刷电机硬件控制原理

<font color=blue>无刷电机跟有刷电机的区别：</font>顾名思义就是无刷电机没有了有刷电机里的电刷。因此它不能够如同有刷电机那样采用机械结构就可以进行电流的换向， 而是必须通过采用如MOS这样的器件实现电子换向。



![image-20241107095818062](dengFOC学习.assets/image-20241107095818062.png)

![image-20241107095831594](dengFOC学习.assets/image-20241107095831594.png)

MOS本质上就是可以理解为一种开关，可以像水龙头控制水流通断一样控制电流通断。

就像上面这张图, 通过控制不同MOS管的通断组合, 电机线圈电流大小和方向就能够被改变。图中的Q0-Q5就是MOS管的代号，而右边的这个带有三个线圈的就是星形无刷电机的连结方式。

**电机转动原理**

![image-20241107100103155](dengFOC学习.assets/image-20241107100103155.png)

当打开Q1管和Q2管, 电流的方向由A相流到B相, 再流出到负极，根据右手螺旋定则，此时电机定子的磁场分布就如上图所示。因此，此时定子线圈就会吸引转子的磁铁转动。但是这时，你会发现当转子磁铁旋转一定角度之后，磁铁此时就停止不动了，因此必须得改变现在的电磁场状态才能够让转子继续转动。

![image-20241107100129868](dengFOC学习.assets/image-20241107100129868.png)

如上图所示，我们只需要接下来把Q1管和Q4管打开, 此时磁场的方向进一步发生改变，转子磁极发生进一步旋转。因此，只需要交替的开关不同的MOS管，就可以实现电机磁极的交替运动，这就是**无刷电机旋转运动的原理**。

![image-20241107100208483](dengFOC学习.assets/image-20241107100208483.png)

上面的这张图，就是总结了转子磁铁旋转一周时各个相的通电情况，那么只要交替的开关这些各个相的MOS管，实现电机的转动。当MOS管开关的速度变快，那么就可以加速转子的转动；当MOS管开关的速度变慢，那么转子的转动速度减慢。

<font color=blue>总结：</font>

对电机的控制实际上就是对MOS管开关规律的控制。而MOS管的开关规律是需要用到单片机程序进行控制的，因此这就引出了我们的FOC控制算法，FOC控制就是一种对电机运动模型进行抽象化和简化，进而有规律控制各个MOS管开关和通断的过程。

## 2. FOC软件控制原理

FOC算法（磁场定向控制算法）：通过一个电机运行模型，实现交替开关各个MOS管的算法。

FOC算法的两个核心：

* 克拉克变换
* 帕克变换

### 2.1 克拉克变换

我们知道，交替开关的MOS管可以实现电机的转动，而这些交替开关的MOS管是以极其快的速度在周期性进行的，把这些周期性的开启和关断过程联系起来，并且对其各个相进行单独观察，就可以得到三个相A、B、C的电流随时间变换的曲线，如下图所示，他们之间存在120°的相位差。

![3.1-1](dengFOC学习.assets/3.1-1.png)

换一个角度来思考此问题，实际上，我们只要能够<font color=blue>控制这个相位差为120°的sin状波形，就能够实现针对电机的控制</font>。而克拉克变换就是实现这个波形控制的第一步。

虽然说是要控制相位差120度的sin状型波形来实现电机控制，但是这个波形其实是极难控制和改变参数的。首先相与相之间是相互耦合的，MOS管一打开就会至少同时打开两个相，所以只想改变一相来实现电机控制是肯定不行的，必须得三相捷联起来一起改变，才能够实现电机的控制。所以，实现电机控制的问题就会变成很复杂。

因此，需要对这个问题进行降维，尽量把这个多变量耦合的问题降解为最好是单一变量的控制问题，克拉克变换就是想做这件事。

所谓<font color=blue>克拉克变换，实际上就是降维解耦的过程，把难以辨明和控制的三相相位差120°电机波形降维为两维矢量</font>。

<font color=red>克拉克变换步骤：</font>

* 第一就是把三相随时间变换的，相位差为120°的电流波形抽象化为三个间隔120°的矢量。

* 第二就是利用三角函数对矢量进行降维，降维到两个坐标轴，从复杂的三相变化问题降解为α-β坐标轴的坐标上的数值变化问题。

![3.1-3](dengFOC学习.assets/3.1-3.png)

上图中，左边是我们把三相120度相位差的sin状波形抽象化为矢量之后的样子，而右边就是我们需要<font color=blue>把这三个矢量进行投影的坐标轴。只要我们把三个矢量都投影到坐标轴上，那么，一个三矢量问题就变成一个二维坐标平面问题</font>。

#### 投影过程的详细推导











## 参考资料

无刷电机和有刷电机的区别：`https://www.sumzi.com/new201509/news_info.aspx?id=9913`





















